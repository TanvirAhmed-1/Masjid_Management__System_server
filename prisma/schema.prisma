generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum RoleType {
  SUPER_ADMIN
  ADMIN
  USER
  MEMBER
}

enum GenderType {
  MALE
  FEMALE
  OTHERS
}
// Mosque Model
model Mosque {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  address   String?
  phone     String?  @unique 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdBy String? @db.ObjectId
  creator   User?   @relation("MosqueCreator", fields: [createdBy], references: [id])

  // Relations
  users                       User[]
  fridayCollections           FridayCollection[]
  ramadanYears                RamadanYear[]
  ifterLists                  IfterList[]
  ifikafLists                 IfikafList[]
  payments                    Payment[]
  members                     Member[]
  ramadantarabiSalaries       RamadantarabiSalary[]
  ramadantarabiSalaryPayments RamadantarabiSalaryPayment[]
  monthlySalaries             MonthlySalary[]
  salaryPayments              SalaryPayment[]
  memberAccessoryPurchases    MemberAccessoryPurchase[]
  otherCollectionNames        OtherCollectionName[]
  otherCollections            OtherCollection[]
  staffs                      Staff[]
  doners                      Doner[]

  @@map("mosque")
}
// User Model
model User {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String     @unique
  password  String
  address   String
  phone     String?    @unique
  role      RoleType   @default(USER)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  gender    GenderType

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)


  createdMosques Mosque[] @relation("MosqueCreator")

  fridayCollections           FridayCollection[]
  ramadanYears                RamadanYear[]
  ifterLists                  IfterList[]
  ifikafLists                 IfikafList[]
  payments                    Payment[]
  members                     Member[]
  ramadantarabiSalaries       RamadantarabiSalary[]
  ramadantarabiSalaryPayments RamadantarabiSalaryPayment[]
  monthlySalaries             MonthlySalary[]
  salaryPayments              SalaryPayment[]
  memberAccessoryPurchases    MemberAccessoryPurchase[]
  otherCollectionNames        OtherCollectionName[]
  otherCollections            OtherCollection[]
  staffs                      Staff[]
  @@index([mosqueId])
  @@map("user")
}
// Collection=Friday Collection Model
model FridayCollection {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  amount         Float
  collectionDate DateTime @default(now())

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, mosqueId])
  @@map("fridaycollection")
}
// Collection= Collection Data setup Model
model OtherCollectionName {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?

  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id])
  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  otherCollections OtherCollection[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, mosqueId])
  @@map("othercollectionname")
}
// Collection= Collection Data name base collection Model
model OtherCollection {
  id                    String              @id @default(auto()) @map("_id") @db.ObjectId
  donors                DonerName[]
  date                  DateTime?
  otherCollectionNameId String              @db.ObjectId
  otherCollectionName   OtherCollectionName @relation(fields: [otherCollectionNameId], references: [id])

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([otherCollectionNameId])
  @@index([userId, mosqueId])
  @@map("othercollection")
}
//ramadan= doner model like ifter doner
model DonerName {
  id           String          @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  amount       Float
  createdAt    DateTime        @default(now())
  collection   OtherCollection @relation(fields: [collectionId], references: [id])
  collectionId String          @db.ObjectId
}
//ramadan= ramadan year create model
model RamadanYear {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  ramadanYear String
  titleName   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  Ifikaflist  IfikafList[]
  doners      IfterList[]
  mosqueId    String?      @db.ObjectId
  mosque      Mosque?      @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  @@index([userId, mosqueId])
  @@map("ramadanyear")
}
//ramadan= ramadan year base ifter list model
model IfterList {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  ramadanyearId String? @db.ObjectId

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  ramadanyear RamadanYear? @relation(fields: [ramadanyearId], references: [id])
  userId      String       @db.ObjectId
  user        User         @relation(fields: [userId], references: [id])
  doners      Doner[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([ramadanyearId])
  @@index([userId, mosqueId])
  @@map("ifterlist")
}
//ramadan= ramadan tarabi salary model
model RamadantarabiSalary {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  ramadanYear String
  totalSalary Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id])

  payments RamadantarabiSalaryPayment[]

  @@index([userId, mosqueId])
  @@map("ramadantarabisalary")
}
//ramadan= ramadan tarabi salary payment model
model RamadantarabiSalaryPayment {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  amount  Float
  payDate DateTime @default(now())

  salaryId String              @db.ObjectId
  salary   RamadantarabiSalary @relation(fields: [salaryId], references: [id])

  memberId String  @db.ObjectId
  member   Member  @relation(fields: [memberId], references: [id])
  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@index([salaryId, mosqueId, memberId, userId])
  @@map("ramadaniftarsalarypayment")
}
//ramadan= ifter list  model
model Doner {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  serialNumber String
  name         String
  iftarDate    DateTime
  dayName      String
  ifterListId  String    @db.ObjectId
  ifterList    IfterList @relation(fields: [ifterListId], references: [id])
  mosqueId     String?   @db.ObjectId
  mosque       Mosque?   @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([ifterListId, mosqueId])
  @@map("doners")
}
//ramadan= ramadan year base ifikaf list model
model IfikafList {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  fromDate  DateTime?
  toDate    DateTime?
  ramadanId String    @db.ObjectId
  userId    String    @db.ObjectId

  ramadanYear RamadanYear @relation(fields: [ramadanId], references: [id])
  user        User        @relation(fields: [userId], references: [id])
  mosqueId    String?     @db.ObjectId
  mosque      Mosque?     @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([userId, ramadanId, mosqueId])
  @@map("ifikaflist")
}

// mosque management = Member create Model
model Member {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  phone         String?   @unique
  address       String?
  monthlyAmount Float
  payments      Payment[]
  createdAt     DateTime  @default(now())
  userId        String    @db.ObjectId
  mosqueId      String?   @db.ObjectId
  mosque        Mosque?   @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  user                        User                         @relation(fields: [userId], references: [id])
  updatedAt                   DateTime                     @updatedAt
  ramadantarabiSalaryPayments RamadantarabiSalaryPayment[]

  @@index([userId, createdAt, mosqueId])
  @@map("member")
}

// mosque management = Member monthly payment/donate Model
model Payment {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  memberId String @db.ObjectId
  member   Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  monthKey String
  amount   Float
  paidDate DateTime @default(now())

  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  mosqueId  String?  @db.ObjectId
  mosque    Mosque?  @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([memberId, monthKey])
  @@index([userId, mosqueId, memberId, monthKey])
  @@map("payment")
}

 // mosque management = Staff name create Model
model Staff {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  image      String?
  address    String
  phone      String?
  role       String
  baseSalary Float
  joinDate   DateTime @default(now())
  createdAt  DateTime @default(now()) 
  updatedAt  DateTime @updatedAt
  active     Boolean  @default(true)

  mosqueId   String?  @db.ObjectId
  mosque     Mosque? @relation(fields: [mosqueId], references: [id])

  userId     String?  @db.ObjectId
  user       User?    @relation(fields: [userId], references: [id])

  salaries   MonthlySalary[]

  @@index([mosqueId])
  @@map("staff")
}

// mosque management = Monthly  staff  Salary Model
model MonthlySalary {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  month   DateTime
  staffId String   @db.ObjectId
  staff   Staff    @relation(fields: [staffId], references: [id])

  totalSalary Float // Full salary amount for the month
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id])

  payments SalaryPayment[]

  @@unique([month, staffId]) // Prevent duplicate month salary
  @@index([staffId, mosqueId])
  @@map("monthlysalary")
}

model SalaryPayment {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  amount  Float
  payDate DateTime @default(now())

  salaryId String        @db.ObjectId
  salary   MonthlySalary @relation(fields: [salaryId], references: [id])

  mosqueId String? @db.ObjectId
  mosque   Mosque? @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@index([salaryId, userId, mosqueId])
  @@map("salarypayment")
}
// mosque management = Member Accessory Purchase Model for masque development purpose
model MemberAccessoryPurchase {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  itemName       String
  quantity       Int      @default(1)
  price          Float
  totalPrice     Float
  purchaseDate   DateTime @default(now())
  description    String?
  paymentReceipt String?
  memberName     String?
  mosqueId       String?  @db.ObjectId
  mosque         Mosque?  @relation(fields: [mosqueId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([userId, mosqueId])
  @@map("member_accessory_purchase")
}
